package com.montydigital.CopsAndRobbers.core
{
	import com.montydigital.CopsAndRobbers.core.gamePlay.Game;
	import com.montydigital.CopsAndRobbers.ui.common.BackBtn;
	import com.montydigital.gameEngine.core.system.ISystem;
	
	import starling.display.StSprite;
	import starling.events.StTouchEvent;
	import starling.events.Touch;
	import starling.events.TouchPhase;
	
	public class CnR_GamePlay extends StSprite implements ISystem
	{
		
		public static const LEVEL_PLAY_BASE:String = "levelPlayBase";
		public static const LEVEL_PLAY_PAUSE:String = "levelPlayPause";
		public static const LEVEL_PLAY_SUCCESS:String = "levelPlaySuccess";
		public static const LEVEL_PLAY_FAIL:String = "levelPlayFail";
		
		private var gameRoot:CnR_GameRoot;
		private var game:Game;
		private var backBtn:BackBtn;
		
		
		public function CnR_GamePlay(root:CnR_GameRoot){
			gameRoot = root;
			
			game = new Game();
			
			backBtn = new BackBtn();
			backBtn.x = 20;
			backBtn.y = this.gameRoot.stage.stageHeight - backBtn.height - 20;
			backBtn.touchable = true;
			backBtn.addEventListener(StTouchEvent.TOUCH, handleBackBtn);
		}
		
		public function enter():void{
			gameRoot.selectedCity.label;
			gameRoot.selectedLevel.label;
			gameRoot.addChild(this);
			this.addChild(backBtn);
		}
		
		public function update():void
		{
		}
		
		public function wait():void
		{
		}
		
		public function exit():void
		{
			gameRoot.removeChild(this);
			this.removeChild(backBtn);
		}
		
		
		private function handleBackBtn(e:StTouchEvent):void{
			var touch:Touch = e.getTouch(backBtn);
			if(touch && touch.phase ==  TouchPhase.ENDED){
				gameRoot.gameFSM.setState(CnR_LevelSelect.LEVEL_SELECT_MAP);
			}
		}
	}
}